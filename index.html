<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×œ×•×— ×©×‘×ª - ×§×”×™×œ×ª ××•×¨×•×ª ×™×©×¨××œ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&family=Frank+Ruhl+Libre:wght@700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #1a3b80; --accent: #c5a059; --bg-color: #f0f4f8; --card-bg: #ffffff; }
        
        body { 
            font-family: 'Rubik', sans-serif; 
            background-color: var(--bg-color); 
            background-image: url('https://www.transparenttextures.com/patterns/white-wall-3.png');
            margin: 0; padding: 20px; color: #333; text-align: center; min-height: 100vh; 
        }

        .container { 
            max-width: 550px; margin: 0 auto; background: var(--card-bg); 
            border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            overflow: hidden; position: relative; padding-bottom: 30px; 
        }

        .header { 
            background: linear-gradient(135deg, var(--primary) 0%, #2a5298 100%); 
            color: white; 
            padding: 12px 20px; 
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; 
            margin-bottom: 20px; 
        }
        
        .logo-container { 
            width: 200px; height: 100px; background: white; 
            border-radius: 10px; margin: 0 auto 5px auto; 
            display: flex; align-items: center; justify-content: center; 
        }
        .logo-img { width: 100%; height: 100%; object-fit: contain; padding: 5px; }
        
        h1 { font-size: 1.6rem; margin: 5px 0; font-weight: 700; }
        h2 { font-size: 1.2rem; margin: 5px 0; color: #ffd700; font-weight: 500; display: none; }

        /* --- CONTENT --- */
        .times-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; margin-top: -10px; }
        .time-card { background: white; padding: 15px; border-radius: 16px; border: 1px solid #eee; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .time-big { font-size: 1.8rem; font-weight: 700; color: var(--primary); display: block; }
        .time-label { font-size: 0.85rem; color: #666; margin-top: 4px; display: block; }

        .section { padding: 20px 25px; text-align: right; border-bottom: 1px dashed #e0e0e0; }
        .section-title { color: var(--accent); font-size: 1.1rem; font-weight: 700; margin-bottom: 12px; }
        
        .event-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 1rem; }
        .event-time { font-weight: 700; color: var(--primary); background: #f0f4ff; padding: 2px 8px; border-radius: 6px; }

        /* --- COLLAPSIBLE DVAR TORAH --- */
        .dvar-torah-box {
            margin: 20px; padding: 0;
            background-color: #fdfbf7; border: 1px solid #e8e0d0; border-radius: 12px;
            text-align: justify; direction: rtl; display: none; 
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .dt-header {
            padding: 15px; background: #fdfbf7; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
        }
        .dt-header:hover { background: #f4efe6; }
        .dt-title { font-family: 'Frank Ruhl Libre', serif; color: var(--primary); font-size: 1.1rem; font-weight: bold; margin: 0; }
        .dt-icon { font-size: 0.8rem; color: #888; }
        
        .dt-content-wrapper { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; padding: 0 15px; }
        .dt-content-wrapper.open { max-height: 1000px; padding-bottom: 15px; border-top: 1px solid #e8e0d0; }

        .dt-text { font-size: 0.95rem; line-height: 1.6; padding-top: 10px; }
        .dt-source { margin-top: 10px; font-size: 0.85rem; color: #666; font-weight: bold; text-align: left; border-top: 1px solid #e8e0d0; padding-top: 5px; }

        /* --- CONTROLS --- */
        .bottom-controls { margin-top: 20px; display: flex; justify-content: center; gap: 15px; padding-top: 10px; border-top: 1px solid #eee; }
        .action-link { color: #666; text-decoration: none; cursor: pointer; background: none; border: 1px solid #ddd; padding: 8px 15px; border-radius: 20px; font-size: 0.9rem; transition: 0.2s; display: flex; align-items: center; gap: 5px; }
        .action-link:hover { background: #fff; color: var(--primary); border-color: var(--primary); }

        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 50px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- PRINT ONLY ELEMENTS --- */
        .print-only-image { display: none; }

        /* =========================================
           ğŸ–¨ï¸ PDF REPLICA PRINT STYLES
           ========================================= */
        @media print {
            @page { margin: 1cm; size: A4 portrait; }
            body { background: white; padding: 0; margin: 0; -webkit-print-color-adjust: exact; }
            
            .container { 
                box-shadow: none; border: none; 
                max-width: 100%; width: 100%; border-radius: 0; 
                padding: 0; margin: 0;
            }

            .header { background: none !important; color: black !important; padding: 0; margin-bottom: 20px; text-align: center; }
            .logo-container { position: absolute; top: 0; left: 0; width: 120px; height: 60px; border: none; }
            .logo-img { width: 100%; object-fit: contain; }

            h1 { color: var(--primary) !important; font-size: 1.8rem; margin-top: 60px; margin-bottom: 5px; text-align: center; }
            h2 { color: #444 !important; display: block !important; font-weight: bold; font-size: 1.1rem; margin-top: 0; text-align: center; }

            /* GRID: FORCE IMAGE LEFT, TEXT RIGHT */
            .print-grid-wrapper {
                display: grid;
                grid-template-columns: 35% 60%; /* Image Left, Text Right */
                gap: 5%;
                margin-bottom: 30px;
                align-items: start;
                direction: ltr; /* <--- CRITICAL: Puts 1st div (Image) on Left */
            }

            /* Reset Content to RTL so text aligns correctly */
            .print-grid-wrapper > div {
                direction: rtl;
            }

            .print-only-image {
                display: block;
                width: 100%; height: 200px;
                background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Jerusalem_Symbol.svg/600px-Jerusalem_Symbol.svg.png');
                background-size: contain; background-repeat: no-repeat; background-position: center;
                opacity: 0.6; border: 1px solid #ddd; border-radius: 8px;
            }

            /* Times Section */
            .times-grid { display: block; padding: 0; margin: 0; }
            .time-card { 
                box-shadow: none; border: none; padding: 0; margin-bottom: 5px; text-align: right;
                display: flex; flex-direction: row-reverse; gap: 10px; justify-content: flex-start;
            }
            .time-big { font-size: 1.2rem; color: black !important; font-weight: bold; width: 60px; }
            .time-label { font-size: 1.1rem; color: black; }

            #erev-shabbat-section { border: none; padding: 10px 0 0 0; text-align: right; }
            #erev-shabbat-section .section-title { color: var(--primary) !important; font-size: 1.2rem; margin-bottom: 5px; text-align: right; background: none; padding: 0; }

            /* Center Stack */
            .center-stack-print { text-align: center; margin-top: 20px; }
            .center-stack-print .section { border: none; padding: 5px 0; text-align: center; }
            .center-stack-print .section-title { color: var(--primary) !important; font-size: 1.2rem; margin-bottom: 10px; text-align: center; background: none; }
            
            .event-row { justify-content: center; gap: 15px; margin-bottom: 5px; }
            .event-time { background: none !important; color: black !important; font-weight: bold; font-size: 1.1rem; }
            .event-desc { font-size: 1.1rem; }
            
            .bottom-controls, .btn, .loader, .dvar-torah-box { display: none !important; }
            .note-box { border: none !important; font-style: italic; text-align: center; margin-top: 10px; }
        }
    </style>
</head>
<body>

<div id="print-area" class="container">
    <div id="loader" class="loader"></div>

    <div id="content" class="hidden">
        <div class="header">
            <div class="logo-container">
                <img src="logo.jpg" alt="Logo" class="logo-img" onerror="this.src='https://img.icons8.com/color/96/star-of-david.png'">
            </div>
            <h1 id="parsha-name">...</h1>
            <h2 id="mevarchim-text"></h2>
        </div>

        <!-- PRINT LAYOUT WRAPPER (Visual Split for PDF) -->
        <div class="print-grid-wrapper">
            <!-- 1. IMAGE (Will be LEFT in Print LTR Grid) -->
            <div class="print-only-image"></div>

            <!-- 2. TIMES (Will be RIGHT in Print LTR Grid) -->
            <div>
                <div class="times-grid">
                    <div class="time-card">
                        <span class="time-big" id="candle-lighting">--:--</span>
                        <span class="time-label">×”×“×œ×§×ª × ×¨×•×ª ×©×‘×ª</span>
                    </div>
                    <div class="time-card">
                        <span class="time-big" id="havdalah">--:--</span>
                        <span class="time-label">×¦××ª ×”×©×‘×ª</span>
                    </div>
                </div>

                <div id="erev-shabbat-section" class="section">
                    <div class="section-title">×¢×¨×‘ ×©×‘×ª</div>
                    <div class="event-row">
                        <span class="event-desc">×× ×—×”, ×§×‘×œ×ª ×©×‘×ª ×•×¢×¨×‘×™×ª</span>
                        <span class="event-time" id="mincha-erev">--:--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- CENTER STACK -->
        <div class="center-stack-print">
            <div class="section">
                <div class="section-title">×©×‘×ª ×§×•×“×©</div>
                <div class="event-row">
                    <span class="event-desc">×©×—×¨×™×ª ×•××•×¡×£</span>
                    <span class="event-time">07:45</span>
                </div>
                <div class="event-row">
                    <span class="event-desc">×ª×¤×™×œ×ª ×™×œ×“×™×</span>
                    <span class="event-time">09:15</span>
                </div>
                
                <div class="note-box" style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 5px; font-size: 0.9rem;">
                     ×©×™×¢×•×¨ ×××ª ×”×¨×‘ × ×ª× ××œ ×‘×”×œ×›×•×ª ×©×‘×ª ×œ××—×¨ ×”×ª×¤×™×œ×”
                </div>
            </div>

            <div class="section">
                <div class="event-row">
                    <span class="event-desc">×œ×™××•×“ ×‘×¡×¤×¨ "××•×¨×•×ª"</span>
                    <span class="event-time">15:00</span>
                </div>
                <div class="event-row">
                    <span class="event-desc">×× ×—×” ×©×œ ×©×‘×ª</span>
                    <span class="event-time">15:45</span>
                </div>
                <div class="event-row">
                    <span class="event-desc">×¢×¨×‘×™×ª ×©×œ ××•×¦××™ ×©×‘×ª</span>
                    <span class="event-time" id="arvit-motzash">--:--</span>
                </div>
            </div>
             <h3 style="display:none; display:block in print; margin-top:20px;">×©×‘×ª ×©×œ×•×!</h3>
        </div>

        <!-- DVAR TORAH (Collapsible) -->
        <div id="dvar-torah-container" class="dvar-torah-box">
            <div class="dt-header" onclick="toggleDt()">
                <div class="dt-title">×¢×œ ×”×¤×¨×©×”</div>
                <div id="dt-icon" class="dt-icon">â–¼ ×”×¦×’</div>
            </div>
            <div id="dt-wrapper" class="dt-content-wrapper">
                <div id="dvar-torah-text" class="dt-text"></div>
                <div id="dvar-torah-source" class="dt-source"></div>
            </div>
        </div>

        <div style="padding: 20px;">
            <a href="https://ul.waze.com/ul?ll=31.72202552%2C35.23175955&navigate=yes&zoom=17" class="btn" style="display:inline-flex;">
                ğŸš— × ×•×•×˜ ×œ×‘×™×ª ×”×›× ×¡×ª
            </a>
        </div>
        
        <!-- EXPORT BUTTONS -->
        <div class="bottom-controls">
            <button onclick="window.print()" class="action-link">
                ğŸ“„ ×©××•×¨ ×›-PDF / ×”×“×¤×¡
            </button>
            <button onclick="exportWord()" class="action-link">
                ğŸ“ ×”×•×¨×“ ×§×•×‘×¥ Word
            </button>
        </div>
    </div>
</div>

<script>
    function toggleDt() {
        const wrapper = document.getElementById('dt-wrapper');
        const icon = document.getElementById('dt-icon');
        wrapper.classList.toggle('open');
        icon.innerText = wrapper.classList.contains('open') ? "â–² ×¡×’×•×¨" : "â–¼ ×”×¦×’";
    }

    setTimeout(() => {
        const loader = document.getElementById('loader');
        if (loader && loader.style.display !== 'none') {
            loader.style.display = 'none';
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('content').classList.add('fade-in');
        }
    }, 4000);

    // --- WORD EXPORT (Cleaned Up) ---
    function exportWord() {
        // 1. Clone the content to modify it for export without changing screen
        const original = document.getElementById('print-area');
        const clone = original.cloneNode(true);

        // 2. Remove unwanted elements from the Word doc
        const controls = clone.querySelector('.bottom-controls');
        if (controls) controls.remove();
        
        const waze = clone.querySelector('a[href*="waze"]');
        if (waze) waze.parentElement.remove(); // Remove parent div padding too

        // 3. Handle Dvar Torah: Remove "Show/Hide" header, Ensure text is visible
        const dtBox = clone.querySelector('.dvar-torah-box');
        if (dtBox) {
            const header = dtBox.querySelector('.dt-header');
            if (header) header.remove(); // Remove the button part

            const wrapper = dtBox.querySelector('.dt-content-wrapper');
            if (wrapper) {
                // Force styles so Word sees it as visible
                wrapper.style.maxHeight = 'none';
                wrapper.style.display = 'block';
                wrapper.classList.add('open');
            }
        }

        // 4. Wrap with David Font
        const contentHtml = clone.innerHTML;
        const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' "+
                       "xmlns:w='urn:schemas-microsoft-com:office:word' "+
                       "xmlns='http://www.w3.org/TR/REC-html40' dir='rtl'><head><meta charset='utf-8'>"+
                       "<style>body { font-family: 'David', sans-serif; font-size: 12pt; }</style>"+
                       "</head><body>";
        const footer = "</body></html>";
        
        const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(header + contentHtml + footer);
        const fileDownload = document.createElement("a");
        document.body.appendChild(fileDownload);
        fileDownload.href = source;
        fileDownload.download = 'shabbat_schedule.doc';
        fileDownload.click();
        document.body.removeChild(fileDownload);
    }

    async function fetchShabbatTimes() {
        try {
            const response = await fetch('data.json?t=' + new Date().getTime());
            if (!response.ok) throw new Error("Data file not found");
            const data = await response.json();

            setText('parsha-name', "×¤×¨×©×ª " + (data.parsha || "×”×©×‘×•×¢"));
            setText('candle-lighting', data.candles);
            setText('havdalah', data.havdalah);
            
            if (data.description) {
                const mevDiv = document.getElementById('mevarchim-text');
                if (mevDiv) {
                    mevDiv.innerText = data.description;
                    mevDiv.style.display = 'block';
                }
            }

            if (data.dvar_torah) {
                const dtText = document.getElementById('dvar-torah-text');
                const dtContainer = document.getElementById('dvar-torah-container');
                const dtSource = document.getElementById('dvar-torah-source');
                
                if (dtText && dtContainer) {
                    dtText.innerText = data.dvar_torah;
                    if (data.dvar_source && dtSource) {
                        dtSource.innerText = data.dvar_source;
                    }
                    dtContainer.style.display = 'block';
                }
            }

            setText('mincha-erev', calculateMincha(data.candles));
            setText('arvit-motzash', calculateArvit(data.havdalah));

            document.getElementById('loader').style.display = 'none';
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('content').classList.add('fade-in');

        } catch (error) {
            console.error("Error:", error);
            setText('parsha-name', "×˜×¢×™× ×” × ×›×©×œ×”...");
            document.getElementById('loader').style.display = 'none';
            document.getElementById('content').classList.remove('hidden');
        }
    }

    function setText(id, text) {
        const el = document.getElementById(id);
        if (el) el.innerText = text;
    }

    function timeToMinutes(timeStr) {
        if(!timeStr) return 0;
        const parts = timeStr.split(':');
        return (parseInt(parts[0]) * 60) + parseInt(parts[1]);
    }

    function minutesToTime(totalMinutes) {
        const h = Math.floor(totalMinutes / 60);
        const m = totalMinutes % 60;
        return `${h}:${m.toString().padStart(2, '0')}`;
    }

    function calculateMincha(candleTimeStr) {
        if(!candleTimeStr) return "--:--";
        const cTime = timeToMinutes(candleTimeStr);
        let target = cTime + 15;
        let rounded = Math.ceil(target / 5) * 5;
        if ((rounded - cTime) > 18) rounded -= 5;
        return minutesToTime(rounded);
    }

    function calculateArvit(havdalahTimeStr) {
        if(!havdalahTimeStr) return "--:--";
        const hTime = timeToMinutes(havdalahTimeStr);
        let target = hTime - 5;
        let rounded = Math.round(target / 5) * 5;
        if ((hTime - rounded) > 8) rounded += 5;
        return minutesToTime(rounded);
    }

    fetchShabbatTimes();
</script>

</body>
</html>