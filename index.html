<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×œ×•×— ×©×‘×ª - ×§×”×™×œ×ª ××•×¨×•×ª ×™×©×¨××œ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&family=Frank+Ruhl+Libre:wght@700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #1a3b80; --accent: #c5a059; --bg-color: #f0f4f8; --card-bg: #ffffff; }
        
        body { 
            font-family: 'Rubik', sans-serif; 
            background-color: var(--bg-color); 
            background-image: url('https://www.transparenttextures.com/patterns/white-wall-3.png');
            margin: 0; padding: 20px; color: #333; text-align: center; min-height: 100vh; 
        }

        .container { 
            max-width: 550px; margin: 0 auto; background: var(--card-bg); 
            border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            overflow: hidden; position: relative; padding-bottom: 30px; 
        }

        /* --- LOGO --- */
        .header { 
            background: linear-gradient(135deg, var(--primary) 0%, #2a5298 100%); 
            color: white; padding: 30px 20px; 
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; 
            margin-bottom: 20px; 
        }
        
        .logo-container { 
            width: 200px; height: 100px; background: white; 
            border-radius: 10px; margin: 0 auto 15px auto; 
            display: flex; align-items: center; justify-content: center; 
        }
        .logo-img { width: 100%; object-fit: contain; }
        
        h1 { font-size: 1.6rem; margin: 5px 0; font-weight: 700; }
        h2 { font-size: 1.2rem; margin: 5px 0; color: #ffd700; font-weight: 500; display: none; }

        /* --- CONTENT --- */
        .times-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; margin-top: -10px; }
        .time-card { background: white; padding: 15px; border-radius: 16px; border: 1px solid #eee; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .time-big { font-size: 1.8rem; font-weight: 700; color: var(--primary); display: block; }
        .time-label { font-size: 0.85rem; color: #666; margin-top: 4px; display: block; }

        .section { padding: 20px 25px; text-align: right; border-bottom: 1px dashed #e0e0e0; }
        .section-title { color: var(--accent); font-size: 1.1rem; font-weight: 700; margin-bottom: 12px; }
        
        /* Screen Layout for Rows */
        .event-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 1rem; }
        .event-time { font-weight: 700; color: var(--primary); background: #f0f4ff; padding: 2px 8px; border-radius: 6px; }

        .dvar-torah-box {
            margin: 20px; padding: 15px;
            background-color: #fdfbf7; border: 1px solid #e8e0d0; border-radius: 12px;
            text-align: justify; direction: rtl; display: none;
        }
        .dt-title { font-family: 'Frank Ruhl Libre', serif; color: var(--primary); font-size: 1.1rem; font-weight: bold; margin-bottom: 8px; text-align: center; }

        /* Controls */
        .top-controls { margin-bottom: 15px; display: flex; justify-content: center; }
        .btn { background: var(--primary); color: white; padding: 12px 30px; text-decoration: none; border-radius: 50px; font-weight: bold; display: inline-flex; align-items: center; gap: 8px; border: none; cursor: pointer; font-size: 1rem; }
        .print-btn { background: #555; font-size: 0.9rem; padding: 8px 20px; }

        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 50px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* =========================================
           ğŸ–¨ï¸ PROFESSIONAL PRINT STYLES
           ========================================= */
        @media print {
            @page { margin: 1cm; size: A4 portrait; }
            body { background: white; padding: 0; margin: 0; }
            
            /* Frame around the whole page */
            .container { 
                box-shadow: none; border: 3px double #444; 
                max-width: 100%; width: 100%; border-radius: 0; 
                padding: 20px; 
                box-sizing: border-box;
                min-height: 95vh;
            }

            /* Clean Header */
            .header { background: none !important; color: black !important; padding: 0; margin-bottom: 20px; border-radius: 0; box-shadow: none; border: none; }
            .logo-container { border: none; margin-bottom: 10px; width: 150px; height: 80px; }
            
            h1 { color: black; font-size: 2.2rem; margin-bottom: 5px; text-decoration: underline; text-underline-offset: 5px; }
            h2 { color: #444 !important; display: block !important; font-weight: bold; font-size: 1.2rem; }

            /* Hide Screen Elements */
            .top-controls, .btn, .loader { display: none !important; }
            
            /* Big Times Grid */
            .times-grid { grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; padding: 0; border-bottom: 2px solid #eee; padding-bottom: 20px; }
            .time-card { box-shadow: none; border: 2px solid #000; padding: 10px; }
            .time-big { color: black !important; font-size: 2rem; }
            .time-label { font-weight: bold; color: #000; }

            /* Sections */
            .section { border-bottom: none; padding: 10px 0; }
            .section-title { color: black !important; font-size: 1.2rem; text-align: center; margin-bottom: 10px; background: #f0f0f0; padding: 5px; border-radius: 5px; -webkit-print-color-adjust: exact; }

            /* --- THE DOTS LEADER EFFECT --- */
            /* This connects "Event Name" ............ "Time" */
            .event-row { 
                display: flex; 
                align-items: baseline; /* Align text bottom */
                margin-bottom: 8px;
            }
            
            .event-desc { 
                flex: 0 0 auto; 
                font-weight: bold; 
                font-size: 1.1rem;
            }
            
            /* The Dotted Line Spacer */
            .event-row::after {
                content: "";
                flex: 1 1 auto;
                border-bottom: 2px dotted #999;
                margin: 0 10px;
                position: relative;
                top: -5px; /* Move dots up slightly */
            }

            .event-time { 
                flex: 0 0 auto; 
                background: none !important; 
                color: black !important; 
                border: none; 
                font-size: 1.2rem; 
                font-weight: bold; 
            }

            /* Boxes */
            .note-box, .dvar-torah-box { 
                background: white !important; 
                border: 1px solid #000 !important; 
                color: black !important; 
                box-shadow: none;
            }
            .dt-title { color: black !important; text-decoration: underline; }
        }
    </style>
</head>
<body>

<div class="top-controls">
    <button onclick="window.print()" class="btn print-btn">
        ×”×“×¤×¡
    </button>
</div>

<div class="container">
    <div id="loader" class="loader"></div>

    <div id="content" class="hidden">
        <div class="header">
            <div class="logo-container">
                <img src="logo.jpg" alt="Logo" class="logo-img" onerror="this.src='https://img.icons8.com/color/96/star-of-david.png'">
            </div>
            <div>×§×”×™×œ×ª ××•×¨×•×ª ×™×©×¨××œ</div>
            <h1 id="parsha-name">...</h1>
            <h2 id="mevarchim-text"></h2>
        </div>

        <div class="times-grid">
            <div class="time-card">
                <span class="time-big" id="candle-lighting">--:--</span>
                <span class="time-label">ğŸ•¯ï¸ ×›× ×™×¡×ª ×©×‘×ª</span>
            </div>
            <div class="time-card">
                <span class="time-big" id="havdalah">--:--</span>
                <span class="time-label">âœ¨ ×¦××ª ×”×©×‘×ª</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">ğŸ“… ×¢×¨×‘ ×©×‘×ª</div>
            <div class="event-row">
                <span class="event-desc">×× ×—×”, ×§×‘×œ×ª ×©×‘×ª ×•×¢×¨×‘×™×ª</span>
                <span class="event-time" id="mincha-erev">--:--</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">ğŸ• ×™×•× ×”×©×‘×ª</div>
            <div class="event-row">
                <span class="event-desc">×©×—×¨×™×ª ×•××•×¡×£</span>
                <span class="event-time">07:45</span>
            </div>
            <div class="event-row">
                <span class="event-desc">×ª×¤×™×œ×ª ×™×œ×“×™×</span>
                <span class="event-time">09:15</span>
            </div>
            
            <div class="note-box" style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 5px; font-size: 0.9rem;">
                 ğŸ’¬ ×©×™×¢×•×¨ ×××ª ×”×¨×‘ × ×ª× ××œ ×‘×”×œ×›×•×ª ×©×‘×ª ×œ××—×¨ ×”×ª×¤×™×œ×”
            </div>
        </div>

        <div id="dvar-torah-container" class="dvar-torah-box">
            <div class="dt-title">ğŸ“– ×©×¤×ª ×××ª ×œ×¤×¨×©×”</div>
            <div id="dvar-torah-text" class="dt-text"></div>
        </div>

        <div class="section">
            <div class="section-title">ğŸŒ† ××—×¨ ×”×¦×”×¨×™×™×</div>
            <div class="event-row">
                <span class="event-desc">×œ×™××•×“ ×‘×¡×¤×¨ "××•×¨×•×ª"</span>
                <span class="event-time">15:00</span>
            </div>
            <div class="event-row">
                <span class="event-desc">×× ×—×” ×©×œ ×©×‘×ª</span>
                <span class="event-time">15:45</span>
            </div>
            <div class="event-row">
                <span class="event-desc">×¢×¨×‘×™×ª ×©×œ ××•×¦××™ ×©×‘×ª</span>
                <span class="event-time" id="arvit-motzash">--:--</span>
            </div>
        </div>

        <div style="padding: 30px;">
            <a href="https://ul.waze.com/ul?ll=31.72202552%2C35.23175955&navigate=yes&zoom=17" class="btn">
                ğŸš— × ×•×•×˜ ×œ×‘×™×ª ×”×›× ×¡×ª
            </a>
        </div>
    </div>
</div>

<script>
    async function fetchShabbatTimes() {
        try {
            const response = await fetch('data.json?t=' + new Date().getTime());
            const data = await response.json();

            setText('parsha-name', "×¤×¨×©×ª " + data.parsha);
            setText('candle-lighting', data.candles);
            setText('havdalah', data.havdalah);
            
            if (data.description) {
                const mevDiv = document.getElementById('mevarchim-text');
                mevDiv.innerText = data.description;
                mevDiv.style.display = 'block';
            }

            if (data.dvar_torah) {
                document.getElementById('dvar-torah-text').innerText = data.dvar_torah;
                document.getElementById('dvar-torah-container').style.display = 'block';
            }

            setText('mincha-erev', calculateMincha(data.candles));
            setText('arvit-motzash', calculateArvit(data.havdalah));

            document.getElementById('loader').style.display = 'none';
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('content').classList.add('fade-in');
        } catch (error) {
            console.error(error);
            setText('parsha-name', "×˜×¢×™× ×” × ×›×©×œ×”");
            document.getElementById('loader').style.display = 'none';
            document.getElementById('content').classList.remove('hidden');
        }
    }

    function setText(id, text) {
        const el = document.getElementById(id);
        if (el) el.innerText = text;
    }

    function timeToMinutes(timeStr) {
        if(!timeStr) return 0;
        const parts = timeStr.split(':');
        return (parseInt(parts[0]) * 60) + parseInt(parts[1]);
    }

    function minutesToTime(totalMinutes) {
        const h = Math.floor(totalMinutes / 60);
        const m = totalMinutes % 60;
        return `${h}:${m.toString().padStart(2, '0')}`;
    }

    function calculateMincha(candleTimeStr) {
        if(!candleTimeStr) return "--:--";
        const cTime = timeToMinutes(candleTimeStr);
        let target = cTime + 15;
        let rounded = Math.ceil(target / 5) * 5;
        if ((rounded - cTime) > 18) rounded -= 5;
        return minutesToTime(rounded);
    }

    function calculateArvit(havdalahTimeStr) {
        if(!havdalahTimeStr) return "--:--";
        const hTime = timeToMinutes(havdalahTimeStr);
        let target = hTime - 5;
        let rounded = Math.round(target / 5) * 5;
        if ((hTime - rounded) > 8) rounded += 5;
        return minutesToTime(rounded);
    }

    fetchShabbatTimes();
</script>

</body>
</html>